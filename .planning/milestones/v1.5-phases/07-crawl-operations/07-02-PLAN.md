---
phase: 07-crawl-operations
plan: 02
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/main/java/dev/alexandria/crawl/LlmsTxtParser.java
  - src/test/java/dev/alexandria/crawl/LlmsTxtParserTest.java
autonomous: true
requirements:
  - CRWL-11

must_haves:
  truths:
    - "LlmsTxtParser extracts URLs from Markdown-link lists in llms.txt format"
    - "LlmsTxtParser handles both llms.txt (URL lists) and llms-full.txt (raw content) inputs"
    - "Parser gracefully handles empty, malformed, or unexpected content"
  artifacts:
    - path: "src/main/java/dev/alexandria/crawl/LlmsTxtParser.java"
      provides: "llms.txt/llms-full.txt parser for URL extraction"
      contains: "parseUrls"
    - path: "src/test/java/dev/alexandria/crawl/LlmsTxtParserTest.java"
      provides: "Unit tests for llms.txt parsing"
      min_lines: 50
  key_links:
    - from: "src/main/java/dev/alexandria/crawl/LlmsTxtParser.java"
      to: "llms.txt format"
      via: "Regex extraction of markdown links"
      pattern: "Pattern\\.compile"
---

<objective>
TDD-develop the LlmsTxtParser utility for parsing llms.txt and llms-full.txt files, extracting URLs from Markdown-format link lists.

Purpose: Enables the llms.txt discovery mechanism (CRWL-11) where documentation sites expose a machine-readable list of their content pages. The parser extracts URLs from the standard llms.txt Markdown format.
Output: LlmsTxtParser class with comprehensive test suite covering the llms.txt specification format.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-crawl-operations/07-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: TDD LlmsTxtParser for URL extraction from llms.txt format</name>
  <files>
    src/main/java/dev/alexandria/crawl/LlmsTxtParser.java
    src/test/java/dev/alexandria/crawl/LlmsTxtParserTest.java
  </files>
  <action>
    **RED phase: Write tests first.**

    **LlmsTxtParser** (`crawl/LlmsTxtParser.java`):
    - Static utility class (private constructor), same pattern as UrlNormalizer and ContentHasher
    - `public static List<String> parseUrls(String llmsTxtContent)`:
      - Parses line-by-line, extracting URLs from Markdown link syntax: `- [Title](URL)` or `- [Title](URL): description`
      - Also supports `[Title](URL)` without leading dash (some llms.txt variants)
      - Returns list of extracted URL strings
      - Ignores header lines (lines starting with `#`), blank lines, blockquote lines (starting with `>`)
      - Uses regex: `Pattern.compile("\\[([^\\]]+)\\]\\(([^)]+)\\)")` to find markdown links
    - `public static boolean isLlmsTxtContent(String content)`:
      - Quick heuristic check: returns true if content contains at least one markdown link and starts with `#` header
      - Used to distinguish llms-full.txt (which is raw Markdown content) from llms.txt (which is a link index)
    - `public static LlmsTxtResult parse(String content)`:
      - Returns a record with `List<String> urls` and `String rawContent` (the original content)
      - If content looks like llms.txt (link index): extract URLs, rawContent is empty
      - If content looks like llms-full.txt (Markdown docs): urls extracted from any inline links, rawContent is the full content for direct ingestion

    **LlmsTxtResult record** (nested in LlmsTxtParser or separate file):
    - `record LlmsTxtResult(List<String> urls, String rawContent, boolean isFullContent)`
    - `isFullContent` = true when content is llms-full.txt (large Markdown for direct ingestion)

    Tests for LlmsTxtParser (`LlmsTxtParserTest`):
    - `parseUrlsExtractsLinksFromStandardFormat` -- standard `- [Title](URL)` format
    - `parseUrlsHandlesLinksWithDescriptions` -- `- [Title](URL): some description`
    - `parseUrlsIgnoresHeadersAndBlankLines` -- `# Header` and empty lines skipped
    - `parseUrlsIgnoresBlockquotes` -- `> summary text` skipped
    - `parseUrlsHandlesLinksWithoutDash` -- `[Title](URL)` without leading dash
    - `parseUrlsReturnsEmptyForNoLinks` -- plain text with no markdown links
    - `parseUrlsReturnsEmptyForNullOrEmpty` -- null and empty string edge cases
    - `parseUrlsExtractsMultipleSections` -- H2 sections with links in each
    - `isLlmsTxtContentDetectsLinkIndex` -- content with header + links returns true
    - `isLlmsTxtContentRejectsPlainMarkdown` -- long prose content returns false
    - `parseDistinguishesLlmsTxtFromLlmsFullTxt` -- llms.txt returns urls with empty rawContent, llms-full.txt returns urls with rawContent

    Example test input (llms.txt format):
    ```
    # Spring Boot Documentation

    > Spring Boot reference documentation

    ## Getting Started

    - [Quick Start](https://docs.spring.io/boot/quick-start): How to get started
    - [Installation](https://docs.spring.io/boot/install)

    ## Reference

    - [Configuration](https://docs.spring.io/boot/config)
    - [Actuator](https://docs.spring.io/boot/actuator): Production features
    ```

    Expected: 4 URLs extracted.

    **GREEN phase: Implement to pass tests.**

    **REFACTOR: Clean up if needed.**
  </action>
  <verify>
    `./gradlew test --tests "dev.alexandria.crawl.LlmsTxtParserTest"` passes. All ~11 tests green.
  </verify>
  <done>LlmsTxtParser correctly parses llms.txt format, extracts URLs from Markdown links, distinguishes llms.txt (link index) from llms-full.txt (raw content), and handles all edge cases gracefully.</done>
</task>

</tasks>

<verification>
- `./quality.sh test` passes with all new tests green
- LlmsTxtParser.parseUrls extracts URLs from standard llms.txt format
- Parser handles edge cases: missing dashes, descriptions after URLs, headers, blockquotes, empty content
- LlmsTxtResult correctly flags llms-full.txt content for direct ingestion
</verification>

<success_criteria>
- All ~11 new unit tests pass
- URL extraction handles all variations of the llms.txt format
- Distinction between llms.txt and llms-full.txt works reliably
- No regressions in existing test suite
</success_criteria>

<output>
After completion, create `.planning/phases/07-crawl-operations/07-02-SUMMARY.md`
</output>
