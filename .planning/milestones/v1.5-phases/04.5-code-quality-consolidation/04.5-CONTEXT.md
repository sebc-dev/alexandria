# Phase 4.5: Code Quality & Test Consolidation - Context

**Gathered:** 2026-02-19
**Status:** Ready for planning

<domain>
## Phase Boundary

Consolidate and strengthen the test suite built over Phases 0-4, increase test coverage where it adds value, refactor overly long methods, add Javadoc, and perform targeted codebase cleanup — ensuring a solid, maintainable foundation before building the MCP integration layer. No new features, no package restructuring.

</domain>

<decisions>
## Implementation Decisions

### Strategie de couverture
- Couverture utilisee comme **outil d'analyse**, pas comme gate bloquant — les rapports identifient les trous, on juge si chaque test manquant vaut la peine d'etre ecrit
- Analyser **tous les packages uniformement** : config, crawl, ingestion/chunking, ingestion/prechunked, search, document, source — radiographie complete
- PIT (mutation testing) lance sur **tout le codebase** pour identifier les tests faibles et les mutations survivantes
- Ajouter des tests unitaires ET des tests d'integration **selon le besoin** — si un service n'a aucun IT, en ajouter ; sinon combler les unitaires

### Scope du refactoring
- Refactoring **pragmatique selon lisibilite** : decouper si la methode fait plusieurs choses distinctes, tolerer si le flux est lineaire et lisible meme au-dela de 30 lignes
- Methodes **publiques et privees** sont toutes candidates au refactoring
- **Pas de restructuration** de patterns, packages ou nommage de classes — on ne touche qu'aux methodes longues
- **Regles Javadoc completes** a appliquer pendant le refactoring :
  - TOUJOURS documenter : classes/interfaces (role, responsabilite, contexte architectural), methodes publiques d'API (intention, contrat, cas limites), @param avec semantique metier, @return avec ce que represente la valeur, @throws avec condition de declenchement, contraintes metier non deductibles du code, records/DTOs pour les champs non evidents
  - JAMAIS documenter : getters/setters triviaux, methodes dont la Javadoc repete le nom, Javadoc generee sans enrichissement, details d'implementation qui changent souvent
  - FORMAT : premiere phrase = resume autonome, utiliser @see et {@link}, annoter @Nullable/@NonNull, preferer les exemples concrets, documenter constantes et valeurs par defaut avec justification

### Consolidation des tests
- **Hybride** pour les fixtures : builders legers pour les entites JPA (DocumentChunk, Source), records construits inline
- **Harmoniser tous les noms de tests** existants vers la convention **camelCase descriptif** (ex: `deliveryWithPastDateIsInvalid`)
- **Structure plate** pour les classes de test — pas de @Nested, tous les tests au meme niveau

### Limites du cleanup
- **Tout est fair game** : aucune zone protegee, Claude peut nettoyer partout dans src/
- Dead code + imports inutilises + **dependances Gradle non utilisees** a auditer et supprimer
- TODOs existants : **resoudre ou supprimer** — chaque TODO est traite, soit implemente soit supprime si plus pertinent
- **Revue complete de la config Spring** : auditer application.yml, verifier que chaque propriete est referencee, reorganiser si necessaire

### Claude's Discretion
- Ordre de traitement des packages (quel package analyser en premier)
- Seuils de couverture par package — pas de minimum impose, jugement au cas par cas
- Choix des mutations PIT a traiter en priorite
- Decisions de refactoring methode par methode (decouper ou non selon complexite cognitive)

</decisions>

<specifics>
## Specific Ideas

- La couverture est un outil de diagnostic, pas un objectif : on veut comprendre ou sont les trous pour decider intelligemment quoi tester
- Les regles Javadoc sont un standard permanent du projet (pas seulement pour cette phase) — la Javadoc couvre le "quoi/pourquoi" local, le markdown (CONVENTIONS.md, CLAUDE.md) couvre le "pourquoi" global
- Les records Java etant deja faciles a construire, les builders ne sont necessaires que pour les entites JPA

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 04.5-code-quality-consolidation*
*Context gathered: 2026-02-19*
