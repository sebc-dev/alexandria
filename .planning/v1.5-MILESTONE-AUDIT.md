---
milestone: v1.5
audited: 2026-02-20T14:30:00Z
status: gaps_found
scores:
  requirements: 36/42
  phases: 8/9
  integration: 18/21
  flows: 2/3
gaps:
  requirements:
    - id: "SRC-01"
      status: "orphaned"
      phase: "Phase 6"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 6 never executed. add_source implemented in Phase 7 (McpToolService.addSource) but not verified under SRC-01 ID."
    - id: "SRC-02"
      status: "orphaned"
      phase: "Phase 6"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 6 never executed. list_sources implemented in Phase 7 but chunk_count is inaccurate (page count, not chunk count)."
    - id: "SRC-03"
      status: "unsatisfied"
      phase: "Phase 6"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 6 never executed. remove_source implemented in Phase 7 but DEFECTIVE: document_chunks.source_id FK is never populated by IngestionService (LangChain4j EmbeddingStore bypasses JPA), so ON DELETE CASCADE does not fire. Chunks remain permanently after source deletion."
    - id: "SRC-04"
      status: "orphaned"
      phase: "Phase 6"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 6 never executed. crawl_status shows last crawl time but no explicit staleness indicator (e.g., 'stale since X days')."
    - id: "SRC-05"
      status: "unsatisfied"
      phase: "Phase 6"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "NOT IMPLEMENTED. No MCP tool exposes aggregate index statistics (total chunks, total sources, storage size, embedding dimensions)."
  integration:
    - from: "IngestionService (LangChain4j EmbeddingStore)"
      to: "document_chunks.source_id FK"
      issue: "source_id column always NULL because LangChain4j PgVectorEmbeddingStore.addAll() bypasses JPA entity mapping. ON DELETE CASCADE from sources to document_chunks never fires."
      affected_requirements: ["SRC-03"]
    - from: "McpToolService.recrawlSource()"
      to: "DocumentChunkRepository.updateSourceNameMetadata()"
      issue: "updateSourceNameMetadata() exists but is never called. If source names change, chunk metadata retains old source_name."
      affected_requirements: ["SRCH-04"]
  flows:
    - flow: "remove_source cascade cleanup"
      breaks_at: "Step 5: document_chunks FK cascade"
      issue: "Source row deleted, ingestion_state cascade-deletes correctly, but document_chunks rows persist permanently (source_id is NULL)."
      affected_requirements: ["SRC-03"]
tech_debt:
  - phase: 08-advanced-search-quality
    items:
      - "Reranker ONNX model files not in git repo — CI integration tests may fail if model not present"
      - "ScoringModel bean @ConditionalOnProperty not used — Spring context fails to start without model files"
  - phase: 07-crawl-operations
    items:
      - "chunk_count on Source set to results.size() (page count proxy, not actual chunk count)"
      - "CRWL-07 (scheduled recrawls) deferred to manual recrawl_source"
  - phase: 04-ingestion-pipeline
    items:
      - "PreChunkedImporter fully implemented and tested but has no MCP entry point"
  - phase: 00-ci-quality-gate
    items:
      - "No VERIFICATION.md (no requirements assigned, so not a blocker)"
  - phase: 01-foundation-infrastructure
    items:
      - "VERIFICATION status: human_needed (Docker runtime tests unverified)"
  - phase: 04.5-code-quality-consolidation
    items:
      - "VERIFICATION status: human_needed (integration tests require Docker)"
---

# Milestone v1.5 Audit Report

**Audited:** 2026-02-20
**Status:** gaps_found
**Overall:** 36/42 requirements satisfied, 5 orphaned/unsatisfied, 1 deferred

## Phase Verification Summary

| Phase | Status | Score | Requirements |
|-------|--------|-------|--------------|
| 0. CI & Quality Gate | No VERIFICATION (no reqs) | N/A | None |
| 1. Foundation & Infrastructure | human_needed | 6/6 | INFRA-01, INFRA-02, INFRA-04, CHUNK-04 |
| 2. Core Search | passed | 9/9 | SRCH-01, SRCH-02, SRCH-03, SRCH-05, SRCH-06 |
| 3. Web Crawling | passed | 5/5 | CRWL-01, CRWL-02, CRWL-04, CRWL-05, CRWL-08 |
| 4. Ingestion Pipeline | passed | 14/14 | CHUNK-01, CHUNK-02, CHUNK-03, CHUNK-05, CHUNK-07 |
| 4.5. Code Quality | human_needed | 4/5 | None |
| 5. MCP Server | passed | 9/9 | MCP-01..05, INFRA-03 |
| 6. Source Management | **NOT STARTED** | 0/0 | SRC-01..05 (ORPHANED) |
| 7. Crawl Operations | passed | 17/17 | CRWL-03, CRWL-06..11 |
| 8. Advanced Search & Quality | passed | 20/20 | SRCH-04, SRCH-07..10, CHUNK-06 |

## Requirements Coverage (3-Source Cross-Reference)

### Satisfied (36/42)

| Requirement | Phase | VERIFICATION | SUMMARY | REQUIREMENTS.md |
|-------------|-------|--------------|---------|-----------------|
| INFRA-01..04 | 1, 5 | passed/human_needed | listed | [x] |
| CRWL-01..06, 08..11 | 3, 7 | passed | listed | [x] |
| CHUNK-01..05, 07 | 1, 4 | passed | listed | [x] |
| CHUNK-06 | 8 | passed | listed | [ ] → update |
| SRCH-01..03, 05..06 | 2 | passed | listed | [x] |
| SRCH-04, 07..10 | 8 | passed | listed | [ ] → update |
| MCP-01..05 | 5 | passed | listed | [x] |

### Deferred (1/42)

| Requirement | Phase | Reason |
|-------------|-------|--------|
| CRWL-07 | 7 | Scheduled recrawls deferred to manual recrawl_source |

### Unsatisfied / Orphaned (5/42)

| Requirement | Phase | Status | Evidence |
|-------------|-------|--------|----------|
| SRC-01 | 6 | orphaned | Phase 6 never executed. add_source works (Phase 7) but not verified under SRC-01 |
| SRC-02 | 6 | orphaned | list_sources works (Phase 7) but chunk_count is inaccurate (page count, not chunks) |
| SRC-03 | 6 | unsatisfied | remove_source DEFECTIVE: chunks not cascade-deleted (source_id FK always NULL) |
| SRC-04 | 6 | orphaned | crawl_status shows last crawl time but no staleness indicator |
| SRC-05 | 6 | unsatisfied | NOT IMPLEMENTED: no index statistics MCP tool |

## Integration Check Results

### Connected (18/21)

All cross-phase wiring from Phase 1 through Phase 8 is properly connected. The dependency chain (infrastructure -> search -> crawling -> ingestion -> MCP -> crawl operations -> search quality) is fully wired.

### Orphaned Exports (2)

1. **DocumentChunkRepository.updateSourceNameMetadata()** — exists but never called. If source names change, chunk metadata retains old source_name.
2. **PreChunkedImporter** — fully implemented and tested but has no MCP tool entry point.

### Missing Connection (1)

**document_chunks.source_id FK never populated** — LangChain4j's `PgVectorEmbeddingStore.addAll()` inserts chunks without setting `source_id`. The `ON DELETE CASCADE` from `sources` to `document_chunks` never fires, leaving orphaned chunks when a source is deleted.

## E2E Flow Analysis

| Flow | Status | Notes |
|------|--------|-------|
| Add source -> crawl -> search | COMPLETE | Full pipeline verified |
| Recrawl with version -> filter search | COMPLETE | Version metadata round-trip works |
| Remove source -> cascade cleanup | DEFECTIVE | Source row deleted, chunks persist permanently |

## Tech Debt Summary

| Phase | Items |
|-------|-------|
| Phase 0 | No VERIFICATION.md (no requirements, non-blocking) |
| Phase 1 | VERIFICATION: human_needed (Docker tests) |
| Phase 4 | PreChunkedImporter has no MCP entry point |
| Phase 4.5 | VERIFICATION: human_needed (Docker tests) |
| Phase 7 | chunk_count is page count proxy; CRWL-07 deferred |
| Phase 8 | Reranker ONNX model not in git (CI risk) |

**Total:** 8 items across 6 phases
